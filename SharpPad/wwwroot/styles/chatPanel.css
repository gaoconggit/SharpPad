:root {
    --chat-transition-delay: 0.3s;
    --chat-panel-width: 520px;
    --chat-min-width: 400px;
    --chat-max-width: 600px;
}

/* 基础聊天面板样式 */
#chatPanel {
    position: fixed;
    right: 0;
    top: 0;
    width: var(--chat-panel-width);
    min-width: var(--chat-min-width);
    max-width: var(--chat-max-width);
    background: #1e1e1e;
    border-left: 1px solid #444;
    display: flex;
    flex-direction: column;
    z-index: 999;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    will-change: transform, height, width;
    box-shadow: -2px 0 8px rgba(0, 0, 0, 0.2);
    /* 动态高度计算 - 为不同屏幕提供合适的底部边距 */
    height: calc(100vh - max(60px, min(120px, 10vh)));
}

/* 超大屏幕 (>= 1920px 宽度) */
@media screen and (min-width: 1920px) {
    #chatPanel {
        height: calc(100vh - 80px);
        --chat-panel-width: 600px;
    }
}

/* 大屏幕 (1600px - 1920px) */
@media screen and (min-width: 1600px) and (max-width: 1919px) {
    #chatPanel {
        height: calc(100vh - 90px);
        --chat-panel-width: 560px;
    }
}

/* Avalonia WebView 窗口专用适配 (1465x830) 
   专门为SharpPad桌面版的默认窗口尺寸优化 */
@media screen and (min-width: 1460px) and (max-width: 1470px) and (min-height: 825px) and (max-height: 835px) {
    #chatPanel {
        height: calc(100vh - 120px); /* 为830px高度提供更多底部空间，确保输入框完全可见 */
        --chat-panel-width: 500px; /* 适合1465px宽度，避免过宽影响编辑器 */
    }
}

/* 标准桌面 (1200px - 1599px) */
@media screen and (min-width: 1200px) and (max-width: 1599px) {
    #chatPanel {
        height: calc(100vh - 100px);
        --chat-panel-width: 520px;
    }
}

/* 小桌面/大笔记本 (1024px - 1199px) */
@media screen and (min-width: 1024px) and (max-width: 1199px) {
    #chatPanel {
        height: calc(100vh - 110px);
        --chat-panel-width: 480px;
    }
}

/* 笔记本/平板横屏 (769px - 1023px) */
@media screen and (min-width: 769px) and (max-width: 1023px) {
    #chatPanel {
        height: calc(100vh - 120px);
        --chat-panel-width: 450px;
        --chat-min-width: 350px;
    }
}

/* 高度特殊适配 */
/* 低分辨率屏幕 (<= 800px 高度) */
@media screen and (max-height: 800px) and (min-width: 769px) {
    #chatPanel {
        height: calc(100vh - 140px);
    }
}

/* 中等高度屏幕适配 (800px - 900px 高度) - 包含Avalonia WebView */
@media screen and (min-height: 800px) and (max-height: 900px) and (min-width: 1200px) {
    #chatPanel {
        height: calc(100vh - 120px); /* 为中等高度提供足够底部空间 */
    }
}

/* 超低分辨率屏幕 (<= 720px 高度) */
@media screen and (max-height: 720px) and (min-width: 769px) {
    #chatPanel {
        height: calc(100vh - 160px);
    }
}

/* 移动端适配 - 精确检测移动设备 */
@media (max-width: 768px) and (pointer: coarse), 
       (max-width: 480px) {
    #chatPanel {
        width: 100%;
        height: 100vh; /* 全屏高度 */
        max-height: calc(100vh - env(safe-area-inset-top, 0px)); /* iOS安全区域适配 */
        position: fixed;
        top: 0;
        bottom: auto;
        left: 0;
        right: 0;
        border-left: none;
        border-top: none;
        z-index: 10001; /* 确保高于所有其他元素 */
        transform: translateY(100%) !important;
        transition: transform var(--chat-transition-delay) ease;
        padding-bottom: max(env(safe-area-inset-bottom, 0px), 16px); /* iOS底部安全区域 */
        --chat-panel-width: 100%;
        --chat-min-width: 100%;
        --chat-max-width: 100%;
    }
    /* 当聊天面板显示时的样式 */
    #chatPanel.active {
        transform: translateY(0) !important;
        opacity: 1;
        visibility: visible;
        display: flex;
    }
    
    .chat-header {
        padding: 8px 12px;
    }
    
    #modelSelect {
        max-width: 140px;
        text-overflow: ellipsis;
    }
    
    .minimized-chat-button {
        display: block; /* 移动端默认显示 */
        bottom: 16px;
        right: 50px;
        top: auto;
        transform: none;
        z-index: 10000; /* 确保高于聊天面板，方便点击 */
    }
    
    .minimized-chat-button .icon-button {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        font-size: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        background: #0078d4;
        border: none;
        color: white;
        transition: all 0.2s;
        cursor: pointer;
    }
    
    .minimized-chat-button .icon-button:hover,
    .minimized-chat-button .icon-button:active {
        background: #0066b8;
        transform: scale(1.05);
    }
    
    .chat-input-area {
        padding: 12px;
        padding-bottom: max(12px, env(safe-area-inset-bottom)); /* 适应iPhone底部安全区域 */
        touch-action: manipulation; /* 禁用手机上点击后放大的效果 */
    }
    
    .chat-messages {
        max-height: calc(85vh - 140px); /* 调整为85vh匹配聊天面板高度 */
    }
    
    /* 防止输入框聚焦时页面被顶上去 */
    .chat-input-area textarea,
    .chat-input-area input {
        position: relative;
        font-size: 16px; /* 避免iOS自动缩放 */
        transform: translateZ(0); /* 启用硬件加速 */
    }
    
    /* 修复Chrome移动版输入问题 */
    html, body {
        height: 100%;
        overflow: hidden;
        position: fixed;
        width: 100%;
        overscroll-behavior: none; /* 防止页面弹性滚动 */
    }
    
    /* 确保内容可滚动 */
    .chat-messages {
        overflow-y: auto;
        -webkit-overflow-scrolling: touch; /* 平滑滚动 */
    }
    
    /* 防止虚拟键盘弹出时视口大小变化 */
    @supports (-webkit-touch-callout: none) {
        .chat-input-area {
            padding-bottom: max(12px, env(safe-area-inset-bottom, 34px));
        }
    }

    .chat-toolbar {
        margin-right: 5vh;
    }
}

body.theme-light #chatPanel {
    background: #f5f5f5;
    border-left: 1px solid #e0e0e0;
    box-shadow: -2px 0 8px rgba(0, 0, 0, 0.1);
}

@media (max-width: 768px) and (pointer: coarse), 
       (max-width: 480px) {
    body.theme-light #chatPanel {
        border-left: none;
        border-top: 1px solid #e0e0e0;
    }
}

.chat-header {
    padding: 12px 16px;
    background: #2d2d2d;
    border-bottom: 1px solid #444;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #ffffff;
    font-size: 14px;
    font-weight: 500;
    flex-shrink: 0; /* 防止头部被压缩 */
    min-height: 48px; /* 确保最小高度 */
}

/* 响应式头部适配 */
@media screen and (max-width: 1023px) {
    .chat-header {
        padding: 10px 12px;
        min-height: 44px;
        font-size: 13px;
    }
}

@media (max-width: 768px) and (pointer: coarse), (max-width: 480px) {
    .chat-header {
        padding: 8px 12px;
        min-height: 40px;
        font-size: 13px;
    }
}

body.theme-light .chat-header {
    background: #e8e8e8;
    border-bottom: 1px solid #e0e0e0;
    color: #333333;
}

.chat-toolbar {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
}

/* 响应式工具栏适配 */
@media screen and (max-width: 1199px) {
    .chat-toolbar {
        gap: 6px;
    }
}

@media screen and (max-width: 1023px) {
    .chat-toolbar {
        gap: 4px;
    }
}

@media (max-width: 768px) and (pointer: coarse), (max-width: 480px) {
    .chat-toolbar {
        gap: 6px;
        flex-wrap: nowrap;
        overflow: hidden;
    }
}

#modelSelect {
    padding: 6px 10px;
    border-radius: 4px;
    border: 1px solid #444;
    background: #3d3d3d;
    color: #ffffff;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s;
    max-width: 180px;
    min-width: 100px;
    text-overflow: ellipsis;
    overflow: hidden;
    white-space: nowrap;
}

#modelSelect:hover {
    border-color: #0078d4;
    background: #404040;
}

/* 响应式模型选择框适配 */
@media screen and (max-width: 1199px) {
    #modelSelect {
        padding: 5px 8px;
        font-size: 12px;
        max-width: 160px;
        min-width: 90px;
    }
}

@media screen and (max-width: 1023px) {
    #modelSelect {
        padding: 4px 6px;
        font-size: 12px;
        max-width: 140px;
        min-width: 80px;
    }
}

@media (max-width: 768px) and (pointer: coarse), (max-width: 480px) {
    #modelSelect {
        padding: 6px 8px;
        font-size: 13px;
        max-width: 120px;
        min-width: 70px;
        border-radius: 6px;
    }
}

body.theme-light #modelSelect {
    border: 1px solid #d1d1d1;
    background: #ffffff;
    color: #333333;
}

    body.theme-light #modelSelect:hover {
        border-color: #0066b8;
        background: #f5f5f5;
    }

#clearChat {
    background-color: #444;
    border: none;
    color: #fff;
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
    opacity: 0.8;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 4px;
}

body.theme-light #clearChat,
body.theme-light #toggleChat,
body.theme-light #modelSettingsBtn {
    background-color: #e0e0e0;
    color: #333333;
    opacity: 1;
}

    body.theme-light #clearChat:hover,
    body.theme-light #toggleChat:hover,
    body.theme-light #modelSettingsBtn:hover {
        background-color: #d0d0d0;
    }

#toggleChat {
    background-color: #444;
    border: none;
    color: #fff;
    padding: 6px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
    opacity: 0.8;
    transition: all 0.2s;
    width: 26px;
    height: 26px;
    display: flex;
    align-items: center;
    justify-content: center;
}

    #toggleChat:hover {
        opacity: 1;
        background-color: #505050;
    }

    #toggleChat::before {
        content: "▼";
        font-size: 10px;
        transition: transform 0.3s;
    }

.chat-messages {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    padding: 16px;
    background: #1e1e1e;
    color: #ffffff;
    display: flex;
    flex-direction: column;
    gap: 16px;
    min-height: 0; /* 确保可以缩小 */
    scroll-behavior: smooth;
    overscroll-behavior: contain;
}

/* 响应式消息区域适配 */
@media screen and (max-width: 1199px) {
    .chat-messages {
        padding: 12px;
        gap: 12px;
    }
}

@media screen and (max-width: 768px) {
    .chat-messages {
        padding: 8px 12px;
        gap: 10px;
    }
}

@media (max-width: 768px) and (pointer: coarse), (max-width: 480px) {
    .chat-messages {
        padding: 8px 12px 12px;
        gap: 8px;
        /* 移动端优化滚动 */
        -webkit-overflow-scrolling: touch;
        overscroll-behavior-y: none;
    }
}

body.theme-light .chat-messages {
    background: #ffffff;
    color: #333333;
}

.chat-message {
    position: relative;
    margin-bottom: 4px;
    padding: 12px 16px;
    border-radius: 12px;
    max-width: 85%;
    word-wrap: break-word;
    line-height: 1.5;
    font-size: 14px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

.user-message {
    background: linear-gradient(135deg, #2b579a, #1e3d6b);
    margin-left: auto;
    color: #ffffff;
    border-bottom-right-radius: 4px;
}

body.theme-light .user-message {
    background: linear-gradient(135deg, #0078d4, #0066b8);
    color: #ffffff;
}

.assistant-message {
    background: #2d2d2d;
    margin-right: auto;
    color: #ffffff;
    border-bottom-left-radius: 4px;
}

body.theme-light .assistant-message {
    background: #f5f5f5;
    color: #333333;
    border: 1px solid #e0e0e0;
}

    body.theme-light .assistant-message:hover {
        background: #f0f0f0;
    }

.chat-input-area {
    padding: 16px;
    border-top: 1px solid #444;
    display: flex;
    flex-direction: column;
    gap: 8px;
    background: #2d2d2d;
    position: relative;
    will-change: border-color;
    min-height: 80px;
    flex-shrink: 0; /* 防止输入区域被压缩 */
    /* 额外保护措施确保输入区域始终可见 */
    z-index: 100;
    box-sizing: border-box;
    /* 强制确保在所有浏览器中正确显示 */
    contain: layout;
}

/* 响应式输入区域适配 */
@media screen and (max-width: 1199px) {
    .chat-input-area {
        padding: 14px;
        min-height: 76px;
    }
}

@media screen and (max-width: 1023px) {
    .chat-input-area {
        padding: 12px;
        min-height: 72px;
    }
}

@media screen and (max-width: 768px) {
    .chat-input-area {
        padding: 10px 12px;
        min-height: 68px;
    }
}

@media (max-width: 768px) and (pointer: coarse), (max-width: 480px) {
    .chat-input-area {
        padding: 12px;
        padding-bottom: max(12px, env(safe-area-inset-bottom, 0px)); /* iOS底部安全区域 */
        min-height: 70px;
        /* 移动端特殊处理 */
        touch-action: manipulation;
        -webkit-user-select: none;
        user-select: none;
    }
}

body.theme-light .chat-input-area {
    border-top: 1px solid #e0e0e0;
    background: #f5f5f5;
}

#chatInput {
    flex: 1;
    resize: none;
    max-height: min(500px, 40vh); /* 响应式最大高度 */
    min-height: 60px;
    padding: 12px;
    border: 1px solid #444;
    border-radius: 8px;
    background: #1e1e1e;
    color: #ffffff;
    font-family: inherit;
    font-size: 14px;
    line-height: 1.5;
    will-change: height;
    transition: height 0.05s ease-out, border-color 0.2s ease;
    outline: none;
    word-wrap: break-word;
    overflow-wrap: break-word;
}

#chatInput:focus {
    border-color: #0078d4;
}

/* 响应式输入框适配 */
@media screen and (max-width: 1199px) {
    #chatInput {
        min-height: 56px;
        padding: 10px 12px;
        max-height: min(400px, 35vh);
    }
}

@media screen and (max-width: 1023px) {
    #chatInput {
        min-height: 52px;
        padding: 10px;
        font-size: 13px;
        max-height: min(300px, 30vh);
    }
}

@media screen and (max-width: 768px) {
    #chatInput {
        min-height: 48px;
        padding: 8px 10px;
        font-size: 13px;
        max-height: min(250px, 25vh);
    }
}

@media (max-width: 768px) and (pointer: coarse), (max-width: 480px) {
    #chatInput {
        min-height: 44px;
        padding: 8px 12px;
        font-size: 16px; /* 防止iOS自动缩放 */
        max-height: min(200px, 20vh);
        border-radius: 12px;
        -webkit-appearance: none;
        -webkit-user-select: text;
        user-select: text;
    }
}

body.theme-light #chatInput {
    border: 1px solid #e0e0e0;
    background: #ffffff;
    color: #333333;
}

    body.theme-light #chatInput:focus {
        border-color: #0066b8;
        outline: none;
    }

.minimized-chat-button {
    position: fixed;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    z-index: 1000;
    display: none; /* 默认隐藏，JavaScript 会在桌面模式下适当控制 */
    transition: all 0.2s ease;
}

.minimized-chat-button .icon-button {
    width: 28px;
    height: 28px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #2d2d2d;
    border: 1px solid #444;
    cursor: pointer;
    color: #fff;
    font-size: 14px;
    opacity: 0.8;
    transition: all 0.2s;
    padding: 0;
}

.minimized-chat-button .icon-button:hover {
    background: #404040;
    opacity: 1;
    transform: translateY(-1px);
}

/* 响应式最小化按钮适配 */
@media screen and (max-width: 1199px) {
    .minimized-chat-button {
        right: 16px;
    }
    
    .minimized-chat-button .icon-button {
        width: 26px;
        height: 26px;
        font-size: 13px;
    }
}

@media screen and (max-width: 1023px) {
    .minimized-chat-button {
        right: 12px;
    }
    
    .minimized-chat-button .icon-button {
        width: 24px;
        height: 24px;
        font-size: 12px;
    }
}

@media (max-width: 768px) and (pointer: coarse), 
       (max-width: 480px) {
    .minimized-chat-button {
        display: block; /* 移动端默认显示 */
        bottom: 16px;
        right: 50px;
        top: auto;
        transform: none;
        z-index: 10000; /* 确保高于聊天面板，方便点击 */
    }
    
    .minimized-chat-button .icon-button {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        font-size: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        background: #0078d4;
        border: none;
        color: white;
        transition: all 0.2s;
    }
    
    .minimized-chat-button .icon-button:hover,
    .minimized-chat-button .icon-button:active {
        background: #0066b8;
        transform: scale(1.05);
    }
}

body.theme-light .minimized-chat-button .icon-button {
    background: #e0e0e0;
    color: #333333;
}

@media (max-width: 768px) and (pointer: coarse), 
       (max-width: 480px) {
    body.theme-light .minimized-chat-button .icon-button {
        background: #0078d4;
        color: white;
        border: none;
    }
    
    body.theme-light .minimized-chat-button .icon-button:hover,
    body.theme-light .minimized-chat-button .icon-button:active {
        background: #d0d0d0;
    }
}

#modelSettingsBtn {
    background-color: #444;
    border: none;
    color: #fff;
    padding: 6px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
    opacity: 0.8;
    transition: all 0.2s;
    width: 26px;
    height: 26px;
    display: flex;
    align-items: center;
    justify-content: center;
}

    #modelSettingsBtn:hover {
        opacity: 1;
        background-color: #505050;
    }

.result-streaming {
    position: relative;
}

    .result-streaming p {
        display: inline;
    }

    .result-streaming .think p {
        display: inline-block;
    }

    /* Base cases for cursor after content */
    .result-streaming:not(:has(pre:last-child, ul:last-child, ol:last-child, div.think:last-child))::after {
        content: "▋";
        margin-left: .25rem;
        vertical-align: baseline;
        animation: cursor-blink 1s infinite;
        display: inline-block;
    }

    /* Cursor for code blocks */
    .result-streaming > pre:last-child code::after {
        content: "▋";
        margin-left: .25rem;
        vertical-align: baseline;
        animation: cursor-blink 1s infinite;
        display: inline-block;
    }

    /* Cursor for list items */
    .result-streaming > ul:last-child > li:last-child::after,
    .result-streaming > ol:last-child > li:last-child::after {
        content: "▋";
        margin-left: .25rem;
        vertical-align: baseline;
        animation: cursor-blink 1s infinite;
        display: inline-block;
    }

    /* New rule for div.think */
    .result-streaming > div.think:last-child::after {
        content: "▋";
        margin-left: .25rem;
        vertical-align: baseline;
        animation: cursor-blink 1s infinite;
        display: inline-block;
    }

@keyframes cursor-blink {
    0% {
        opacity: 1;
    }

    50% {
        opacity: 0;
    }

    100% {
        opacity: 1;
    }
}

.think {
    padding: 10px;
    margin: 10px 0;
    border-left: 4px solid #42b983;
    /*background-color: #f3f5f7;*/
    border-radius: 4px;
}

body.theme-light .think {
    padding: 10px;
    margin: 10px 0;
    border-left: 4px solid #42b983;
    background-color: #f3f5f7;
    border-radius: 4px;
}

/* 聊天面板拖动手柄 */
#chatPanel .resize-handle {
    position: absolute;
    left: -5px;
    width: 10px;
    top: 0;
    bottom: 0;
    cursor: ew-resize;
    background: transparent;
    z-index: 1000;
    transition: background-color 0.2s ease;
}

#chatPanel .resize-handle:hover {
    background: rgba(0, 120, 212, 0.1);
}

/* 自定义滚动条样式 */
.chat-messages::-webkit-scrollbar {
    width: 6px;
}

.chat-messages::-webkit-scrollbar-track {
    background: transparent;
}

.chat-messages::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.2);
    border-radius: 3px;
    transition: background 0.2s ease;
}

.chat-messages::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.3);
}

body.theme-light .chat-messages::-webkit-scrollbar-thumb {
    background: rgba(0, 0, 0, 0.2);
}

body.theme-light .chat-messages::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 0, 0, 0.3);
}

/* 响应式滚动条 */
@media (max-width: 768px) and (pointer: coarse), (max-width: 480px) {
    .chat-messages::-webkit-scrollbar {
        width: 4px;
    }
}

/* 性能优化 */
#chatPanel * {
    box-sizing: border-box;
}

#chatPanel .chat-message {
    contain: layout style;
}

/* 避免重绘优化 */
#chatPanel {
    contain: layout style;
    transform: translateZ(0); /* 启用硬件加速 */
}

/* macOS WebKit 特殊优化 */
@supports (-webkit-appearance: none) {
    /* macOS Safari/WebKit 特有的渲染优化 */
    #chatPanel {
        -webkit-transform: translateZ(0);
        -webkit-backface-visibility: hidden;
        -webkit-perspective: 1000px;
    }
    
    /* 确保在 macOS WebView 中正确计算高度 */
    @media screen and (min-width: 1460px) and (max-width: 1470px) and (min-height: 825px) and (max-height: 835px) {
        #chatPanel {
            /* macOS Avalonia WebView 特殊处理 */
            height: calc(100vh - 120px) !important;
            min-height: 400px; /* 确保最小高度 */
        }
        
        .chat-messages {
            /* 强制重新计算滚动区域 */
            min-height: 200px;
            flex-basis: auto;
        }
        
        .chat-input-area {
            /* 确保输入区域在 macOS 上可见 */
            min-height: 80px !important;
            flex-shrink: 0 !important;
            /* 强制确保输入区域完整显示 */
            position: relative;
            bottom: 0;
            background: #2d2d2d !important;
            border-top: 1px solid #444 !important;
        }
        
        #chatInput {
            /* macOS WebView 中确保输入框完整显示 */
            min-height: 60px !important;
            height: auto;
            max-height: 200px;
            /* 防止被其他元素遮挡 */
            z-index: 10;
            position: relative;
        }
    }
}

/* macOS 特定的字体渲染优化 */
@media screen and (-webkit-min-device-pixel-ratio: 1) {
    #chatPanel,
    .chat-messages,
    .chat-input-area,
    #chatInput {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }
}

@media (max-width: 768px) and (pointer: coarse), 
       (max-width: 480px) {
    #chatPanel .resize-handle {
        display: none; /* 移动端不显示调整大小的手柄 */
    }
}

/* 当面板正在调整大小时的样式 */
#chatPanel.resizing {
    transition: none;
    cursor: ew-resize;
}

/* 添加显示/隐藏聊天面板的过渡效果 */
#chatPanel.minimized {
    transform: translateX(calc(100% - 30px));
}

@media (max-width: 768px) and (pointer: coarse), 
       (max-width: 480px) {
    #chatPanel.minimized {
        transform: translateY(100%) !important; /* 确保在移动端完全隐藏 */
        visibility: hidden; /* 增加可见性设置，确保完全不可见 */
    }
}

/* 确保在小屏幕设备上消息不会太宽 */
@media (max-width: 768px) and (pointer: coarse), 
       (max-width: 480px) {
    .chat-message {
        max-width: 90%;
    }
    
    .chat-input-area {
        padding: 12px;
    }
    
    #chatInput {
        min-height: 50px;
    }
}

.mobile-icon {
    display: none;
}

.desktop-icon {
    display: inline-block;
}

@media (max-width: 768px) and (pointer: coarse), 
       (max-width: 480px) {
    .mobile-icon {
        display: inline-block;
        font-size: 24px;
    }
    
    .desktop-icon {
        display: none;
    }
}

/* 特殊设备适配 */
/* iPad和其他大屏平板 */
@media screen and (min-width: 769px) and (max-width: 1024px) and (orientation: landscape) {
    #chatPanel {
        --chat-panel-width: 400px;
        height: calc(100vh - 100px);
    }
}

@media screen and (min-width: 769px) and (max-width: 1024px) and (orientation: portrait) {
    #chatPanel {
        --chat-panel-width: 350px;
        height: calc(100vh - 120px);
    }
}

/* 超宽屏适配 */
@media screen and (min-width: 2560px) {
    #chatPanel {
        --chat-panel-width: 650px;
        height: calc(100vh - 60px);
    }
}

/* 高DPI屏幕优化 */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    #chatPanel .resize-handle {
        width: 8px;
        left: -4px;
    }
    
    .chat-messages::-webkit-scrollbar {
        width: 4px;
    }
}

/* 减少动画以提高性能 */
@media (prefers-reduced-motion: reduce) {
    #chatPanel,
    #chatPanel *,
    .minimized-chat-button,
    .minimized-chat-button * {
        transition: none !important;
        animation: none !important;
    }
}

/* 黑暗模式系统偏好 */
@media (prefers-color-scheme: dark) {
    :root {
        color-scheme: dark;
    }
}

/* 高对比度模式适配 */
@media (prefers-contrast: high) {
    #chatPanel {
        border-left: 2px solid #ffffff;
    }
    
    .chat-header {
        border-bottom: 2px solid #ffffff;
    }
    
    .chat-input-area {
        border-top: 2px solid #ffffff;
    }
    
    #chatInput {
        border: 2px solid #ffffff;
    }
}
